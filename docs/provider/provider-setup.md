---
sidebar_position: 1
slug: /provider-setup
title: Setup
---

# Provider Setup

This guide is designed to help node runners and DevOps professionals configure a multi-chain network provider, which supports various blockchain networks and their respective API interfaces. We'll walk you through the necessary steps to create a configuration file that covers multiple chains and API interfaces, and provide a brief background on providers and the stake command.

## **Overview**

A multi-chain network provider allows you to manage and interact with multiple blockchain networks using a single entry point. By supporting various API interfaces, the provider can accommodate the specific needs and preferences of different blockchain networks.

In this guide, we'll create a configuration file that includes multiple chains (Ethereum Mainnet and Osmosis Mainnet) and their respective API interfaces (JSON-RPC, REST, gRPC, and Tendermint RPC). We'll also cover the stake command for providers, which allows you to stake a specific service.

## **Prerequisites**

1. Go 1.18 or higher
2. `lavad` installed (build or install at [https://github.com/lavanet/lava](https://github.com/lavanet/lava))
3. Account with enough LAVA for staking (learn about [creating Accounts](docs/lava-blockchain/account-wallet.mdx))
4. Know which chains you want to provide ([how to query the latest list](provider#chains))

## Step 1: Stake as Provider

Before you can run a multi-chain network provider, you need to stake a provider. To stake a single service, use the following command:

```bash
lavad tx pairing stake-provider [chain-id] [amount] [endpoint endpoint ...] [geolocation] [flags]
```

*Check the output for the status of the staking operation. A successful operation will have a code **`0`**.*

#### Parameters Description

- **`chain-id`** - The ID of the serviced chain (e.g., **`COS4`** or **`FTM250`**).
- **`amount`** - Stake amount for the specific chain (e.g., **`2010ulava`**).
- **`endpoint`** - Provider host listener, composed of `provider-host:provider-port,interface,geolocation`
- **`geolocation`** - Indicates the geographical location where the process is located (e.g., **`1`** for US or **`2`** for EU).

#### Flags Details

- **`--from`** - The account to be used for the provider staking (e.g., **`my_account`**).
- `--moniker` - Providerâ€™s public name
- **`--keyring-backend`** - A keyring-backend of your choosing (e.g., **`test`**).
- **`--chain-id`** - The chain_id of the network (e.g., **`lava-testnet-1`**).
- **`--gas`** - The gas limit for the transaction (e.g., **`"auto"`**).
- **`--gas-adjustment`** - The gas adjustment factor (e.g., **`"1.5"`**).
- **`--node`** - A RPC node for Lava (e.g., **`https://public-rpc.lavanet.xyz:443/rpc/`**).

### Stake Examples

#### Ethereum Mainnet in US
Ethereum and other EVMs usually have only `jsonrpc` interface:

```bash
lavad tx pairing stake-provider "ETH1" \
    "500000000000ulava" \
    "provider-host.com:1337,jsonrpc,1" 1 \
    --from "my_account_name" \
    --moniker=%%your-moniker%% \
    --keyring-backend "test" \
    --chain-id "lava-testnet-1" \
    --gas="auto" \
    --gas-adjustment "1.5" \
    --node "https://public-rpc.lavanet.xyz:443/rpc/"
```

#### Cosmos Hub Testnet in US
Cosmos's usually have `rest`, `tendermintrpc` & `grpc` interface, all mandatory:

```bash
lavad tx pairing stake-provider "COS5T" \
    "500000000000ulava" \
    "provider-host.com:1986,tendermint,1 provider-host.com:1986,rest,1 provider-host.com:1986,grpc,1" 1 \
    --from "my_account_name" \
    --moniker=%%your-moniker%% \
    --keyring-backend "test" \
    --chain-id "lava-testnet-1" \
    --gas="auto" \
    --gas-adjustment "1.5" \
    --node "https://public-rpc.lavanet.xyz:443/rpc/"
```

## Step 2: Verify stake

To ensure that your account is successfully staked with the providers for a specific network, execute the following command. Make sure to check if your account's public address is present in the list generated by the command output:

```bash
lavad query pairing providers \
"{NETWORK_NAME}" \
--node "{LAVA_RPC_NODE}"

# Example: checking if your account is a paired provider for the ETH1 network,
# lavad query pairing providers \
# ETH1 \
# --node https://public-rpc.lavanet.xyz:443/rpc/

# Expected output:
# INF Server listening Address=[::]:LISTEN_PORT
```

#### Parameter Descriptions (with examples):

- **`NETWORK_NAME`** - The ID of the chain. Examples: **`COS4`** or **`FTM250`**
- **`LAVA_RPC_NODE`** - An RPC node for Lava. This can be omitted if the current node has already joined the Lava network. Example: **`https://public-rpc.lavanet.xyz:443/rpc/`**

## Step 3: Run RPCProvider process

**`rpcprovider`** is a command line tool for setting up an RPC server that listens for requests from Lava protocol RPC consumers, forwards them to a configured node, and responds with the reply. The configuration can be provided via a YAML configuration file or as command line arguments.

**`rpcprovider`** is part of `lavad` and can run using the following syntax:

```bash
lavad rpcprovider [config-file] || { {listen-host:listen-port spec-chain-id api-interface node-url} ... }
```

### Configuration

You can either provide a single configuration file (YAML) or specify one or more endpoint configurations as command line arguments.

The default configuration file is named **`rpcprovider.yml`**. If a single argument is provided, it is assumed to be the name of the configuration file (without the extension).

If no arguments are provided, the default configuration file is used. All configuration files should be located in the default node home directory (e.g., **`app.DefaultNodeHome/config`**) or the local running directory.

### Command Flags

**`rpcprovider`** accepts the following flags:

- **`--geolocation`** (required): Geolocation to run from (e.g., **`1`**)
- **`--from`** (required): Account name to use (e.g., **`alice`**)
- **`--chain-id`**: Lava Network chain ID (e.g.: **`lava-testnet-1`**)
- **`--pprof-address`**: pprof server address, used for code profiling (default: **`""`**)
- **`--cache`**: Address for a cache server to improve performance (default: **`""`**)
- **`--parallel-connections`**: Number of parallel connections (default: **`chainproxy.NumberOfParallelConnections`**)

### Configuration Examples

Here are some example usages of **`rpcprovider`**:

```bash
# Using a custom configuration file and flags
lavad rpcprovider path_to_my_config_file --geolocation 1 --from alice

# Providing endpoint configurations as command line arguments
lavad rpcprovider provider-host.com:1986 ETH1 jsonrpc https://localhost/eth/my_node_1 --geolocation 1 --from alice
```

### Example: Multiple API Interfaces with Same Listen Address (ETH1 and COS3)

In this example, the provider supports all the API interfaces for the Ethereum Mainnet (ETH1) and Osmosis Mainnet (COS3) networks. The listen address for all ETH1 interfaces and all COS3 interfaces is the same.

```yaml
endpoints:
  - api-interface: jsonrpc
    chain-id: ETH1
    network-address: 127.0.0.1:2221
    node-urls:
      - url: wss://eth-rpc/ws
  - api-interface: tendermintrpc
    chain-id: COS3
    network-address: 127.0.0.1:2221
    node-urls:
      - url: ws://127.0.0.1:26657/websocket
      - url: http://127.0.0.1:26657
  - api-interface: grpc
    chain-id: COS3
    network-address: 127.0.0.1:2221
    node-urls: 
      - url: 127.0.0.1:9090
  - api-interface: rest
    chain-id: COS3
    network-address: 127.0.0.1:2221
    node-urls: 
      - url: http://127.0.0.1:1317
```

### Another Example using Server Authentication

In this example COS3 tendermint urls are using client authentication


#### Example 1, auth-headers

If you want to add the authentication using the http headers

```yaml
endpoints:
  - api-interface: tendermintrpc
    chain-id: COS3
    network-address: 127.0.0.1:2221
    node-urls:
      - url: ws://127.0.0.1:26657/websocket
        auth-config:
        auth-headers:
          WANTED_HEADER_NAME_1: xyz
      - url: http://127.0.0.1:26657
        auth-config:
        auth-headers:
          WANTED_HEADER_NAME_2: xxyyzz
```

#### Example 2, auth-query 

If you want to add the authentication using query parameters

```yaml
endpoints:
    - api-interface: tendermintrpc
      chain-id: COS3
      network-address: 127.0.0.1:2221
      node-urls:
        - url: ws://127.0.0.1:26657/websocket
          auth-config:
          auth-query: auth=xxyyzz
        - url: http://127.0.0.1:26657
          auth-config:
          auth-query: auth=xyz
```

### Load Balance based on IP 

If you want to IP load balance / throttle this is also supported by adding "ip-forwarding: true" 
The Ip will be added to the following header: "X-Forwarded-For"

```yaml
endpoints:
    - api-interface: jsonrpc
      chain-id: ETH1
      network-address: 127.0.0.1:2221
      node-urls: 
        - url: ws://your_node_url/
          auth-config:
          auth-query: auth=xyz
          ip-forwarding: true
```




## Step 4: Check Provider liveliness

To ensure your provider is up and running, you can use the provided script to check the liveliness of your provider by either its moniker or address. This script will help you confirm that the gRPC calls to your provider are working correctly.

#### Usage

1. Install the **`grpcurl`** command-line tool, if not already installed:
    
    ```
    go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest
    ```
    
2. Download the **[python script](/gists/provider_liveliness_check.py)**.
3. Run the script using one of the following options:
    - To check by moniker:
        
        ```bash
        python provider_liveliness.py --chain_id {CHAIN_ID} --moniker {MONIKER}
        ```
        
    - To check by address:
        
        ```bash
        python provider_liveliness.py --chain_id {CHAIN_ID} --address {ADDRESS}
        ```
        
    
    Replace **`{CHAIN_ID}`** with the chain ID (e.g., **`COS4`** or **`FTM250`**), **`{MONIKER}`** with your provider's moniker, and **`{ADDRESS}`** with your provider's address.
    

#### Output

The script will output the status of each endpoint, indicating whether it's accessible (**`OK`**) or not (**`ERROR`**), along with any error details.

For example:

```bash
192.0.2.1:12345: OK
192.0.2.2:12345: ERROR - some error details
```

Use this script periodically to ensure your provider remains operational and to troubleshoot any connectivity issues.

## Step 5: Provider Info and more features

You can track your Provider rewards and transactions via [https://info.lavanet.xyz/providers](https://info.lavanet.xyz/providers) 

And review the Providers Features page for more capabilities. 

## FAQ

#### `lavad` not found

Make sure you downloaded/built the binary, and it is located in the path you use to run `lavad` commands, or you have it under /usr/local/bin or under PATH

#### Received error `account sequence mismatch`

Try to wait for a block_time (current=30s) and then run the command again

#### How do I unstake? {#unstake}

Run the following command:

```
lavad tx pairing unstake-provider "{NETWORK_NAME}" \\
--from "{ACCOUNT_NAME}" \\
--keyring-backend "{KEYRING_BACKEND}" \\
--chain-id "{CHAIN_ID}" \\
--node "{LAVA_RPC_NODE}"

# For example, unstake a provider for the ETH1 network,
# lavad tx pairing unstake-provider ETH1 \\
# --from my_account_name \\
# --keyring-backend "test" \\
# --chain-id "lava-testnet-1" \\
# --node <https://public-rpc.lavanet.xyz:443/rpc/>

# Expected output:
# INF Server listening Address=[::]:LISTEN_PORT

```

#### Received error `dial tcp 127.0.0.1:26657: connect: connection refused`

In case you got the following error:

```
Error: post failed: Post "<http://localhost:26657>": dial tcp 127.0.0.1:26657: connect: connection refused

```

It is likely that your node is not running, or has not joined the network, you can either join the network,
or run the command with the `--node` flag to use an external Lava RPC node

#### Received error `sentry init failure to initialize error="provider stake verification mismatch`

In case you got the following error:

```
ERR sentry init failure to initialize error="provider stake verification mismatch -- &map[ChainID:NETWORK_NAME spec name:NETWORK_FULL_NAME]" ChainID=CHAIN_ID apiInterface=PROTOCOL

```

It is likely that the stake-provider command was not taken into effect yet, if running the `lavad server` option, please wait a few minutes and try running the command again.
